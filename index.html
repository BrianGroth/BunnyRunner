<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Endless Runner: Rabbit Emoji Adventure Plus</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #eef;
    }
    /* Both canvases overlay each other */
    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <!-- Background canvas for sky, ground, and clouds -->
  <canvas id="bgCanvas"></canvas>
  <!-- Foreground canvas for game objects -->
  <canvas id="gameCanvas"></canvas>

  <script>
    // Get canvas elements and contexts.
    const bgCanvas = document.getElementById("bgCanvas");
    const bgCtx = bgCanvas.getContext("2d");
    const gameCanvas = document.getElementById("gameCanvas");
    const ctx = gameCanvas.getContext("2d");

    // Global game state and settings.
    let initialScore = 10;
    let score = initialScore;
    let difficulty = 0;  // increases over time
    let gameStarted = false;
    let gameOver = false;
    let spawnTimer = 0;
    let outchTimer = 0;  // timer to display "outch" when hit
    let groundY; // y-coordinate for the ground

    // Define the rabbit character.
    const rabbitSize = 50;
    let rabbit = {
      x: 50,
      y: 0, // will be set in resize()
      size: rabbitSize,
      velocityY: 0,
      jumpForce: -12,
      gravity: 0.5
    };

    // Array for food and obstacle items.
    let items = [];

    // Cloud objects for a creative sky.
    let clouds = [];
    function initClouds() {
      clouds = [];
      for (let i = 0; i < 5; i++) {
        let x = Math.random() * bgCanvas.width;
        let y = Math.random() * (bgCanvas.height / 2);
        let speed = 0.3 + Math.random() * 0.7;
        clouds.push({ x, y, speed });
      }
    }

    // Setup canvas sizes.
    function resize() {
      bgCanvas.width = window.innerWidth;
      bgCanvas.height = window.innerHeight;
      gameCanvas.width = window.innerWidth;
      gameCanvas.height = window.innerHeight;
      groundY = gameCanvas.height - 50;
      // Update rabbit's y position based on ground level.
      rabbit.y = groundY - rabbit.size;
      initClouds(); // reset clouds on resize
    }
    window.addEventListener("resize", resize);
    // Call resize AFTER rabbit and initClouds are defined.
    resize();

    // Spawn a food or obstacle item.
    function spawnItem() {
      let type = Math.random() < 0.6 ? 'food' : 'obstacle';
      let emoji;
      if (type === 'food') {
        const foods = ['🍎', '🍌', '🍇', '🍉', '🍓', '🍊', '🥕', '🥦'];
        emoji = foods[Math.floor(Math.random() * foods.length)];
      } else {
        const obstacles = ['🌳', '🪨'];
        emoji = obstacles[Math.floor(Math.random() * obstacles.length)];
      }
      let y;
      if (type === 'food') {
        // Food appears at a random height above ground.
        y = groundY - rabbitSize - Math.random() * 150;
        if (y < 0) y = 0;
      } else {
        // Obstacles near the ground.
        y = groundY - 40;
      }
      let size = 40;
      let baseSpeed = 5;
      // Increase speed as difficulty increases.
      let speed = baseSpeed + difficulty;
      items.push({ type, emoji, x: gameCanvas.width, y, size, speed });
    }

    // Update game objects.
    function update() {
      // If game over, halt game updates (except for "outch" timer).
      if (gameOver) {
        if (outchTimer > 0) outchTimer--;
        return;
      }

      // Increase difficulty gradually.
      if (gameStarted) {
        difficulty += 0.005;
      }

      // Update rabbit physics.
      rabbit.velocityY += rabbit.gravity;
      rabbit.y += rabbit.velocityY;
      if (rabbit.y > groundY - rabbit.size) {
        rabbit.y = groundY - rabbit.size;
        rabbit.velocityY = 0;
      }

      // Update clouds (move them slowly).
      clouds.forEach(cloud => {
        cloud.x -= cloud.speed;
        if (cloud.x < -50) {
          cloud.x = bgCanvas.width;
          cloud.y = Math.random() * (bgCanvas.height / 2);
        }
      });

      // Update items and check collisions.
      for (let i = items.length - 1; i >= 0; i--) {
        let item = items[i];
        item.x -= item.speed;

        // Simple collision detection.
        if (
          item.x < rabbit.x + rabbit.size &&
          item.x + item.size > rabbit.x &&
          item.y < rabbit.y + rabbit.size &&
          item.y + item.size > rabbit.y
        ) {
          if (item.type === 'food') {
            score += 1;
          } else {
            score -= 1;
            outchTimer = 30; // show "outch" for 30 frames
          }
          items.splice(i, 1);
          // End game if score is 0 or less.
          if (score <= 0) {
            score = 0;
            gameOver = true;
          }
        } else if (item.x + item.size < 0) {
          items.splice(i, 1);
        }
      }

      // Adjust spawn interval based on difficulty.
      let spawnInterval = Math.max(30, 90 - Math.floor(difficulty * 10));
      spawnTimer++;
      if (spawnTimer > spawnInterval) {
        spawnItem();
        spawnTimer = 0;
      }

      if (outchTimer > 0) outchTimer--;
    }

    // Draw the creative background.
    function drawBackground() {
      bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
      // Sky gradient.
      let gradient = bgCtx.createLinearGradient(0, 0, 0, bgCanvas.height);
      gradient.addColorStop(0, "#aee");
      gradient.addColorStop(1, "#ccf");
      bgCtx.fillStyle = gradient;
      bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);
      // Draw clouds.
      bgCtx.font = "30px sans-serif";
      clouds.forEach(cloud => {
        bgCtx.fillText("☁️", cloud.x, cloud.y);
      });
      // Ground.
      bgCtx.fillStyle = "#654321";
      bgCtx.fillRect(0, groundY, bgCanvas.width, bgCanvas.height - groundY);
    }

    // Draw game objects.
    function drawGame() {
      ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
      // Draw the rabbit.
      ctx.font = rabbit.size + "px sans-serif";
      ctx.fillText("🐰", rabbit.x, rabbit.y + rabbit.size);
      // Display items.
      items.forEach(item => {
        ctx.font = item.size + "px sans-serif";
        ctx.fillText(item.emoji, item.x, item.y + item.size);
      });
      // Show "outch" if needed.
      if (outchTimer > 0) {
        ctx.font = "20px sans-serif";
        ctx.fillStyle = "red";
        ctx.fillText("outch", rabbit.x, rabbit.y - 10);
      }
      // Display score.
      ctx.font = "24px sans-serif";
      ctx.fillStyle = "#000";
      ctx.fillText("Score: " + score, 10, 30);

      // If game hasn't started.
      if (!gameStarted && !gameOver) {
        ctx.font = "30px sans-serif";
        ctx.fillStyle = "rgba(0,0,0,0.5)";
        ctx.fillText("Tap to start and jump!", gameCanvas.width / 2 - 150, gameCanvas.height / 2);
      }
      // If game over.
      if (gameOver) {
        ctx.font = "40px sans-serif";
        ctx.fillStyle = "black";
        ctx.fillText("Game Over", gameCanvas.width / 2 - 100, gameCanvas.height / 2 - 20);
        ctx.font = "30px sans-serif";
        ctx.fillText("Tap to Restart", gameCanvas.width / 2 - 100, gameCanvas.height / 2 + 20);
      }
    }

    // Main game loop.
    function gameLoop() {
      update();
      drawBackground();
      drawGame();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();

    // Jump and start/restart control.
    function jumpOrRestart() {
      if (gameOver) {
        restartGame();
        return;
      }
      if (!gameStarted) {
        gameStarted = true;
      }
      // Jump only if on the ground.
      if (rabbit.y >= groundY - rabbit.size - 1) {
        rabbit.velocityY = rabbit.jumpForce;
      }
    }

    // Restart the game by resetting variables.
    function restartGame() {
      score = initialScore;
      difficulty = 0;
      gameStarted = false;
      gameOver = false;
      spawnTimer = 0;
      items = [];
      rabbit.x = 50;
      rabbit.y = groundY - rabbit.size;
      rabbit.velocityY = 0;
      outchTimer = 0;
      initClouds();
    }

    // Listen for touch or mouse events.
    gameCanvas.addEventListener("touchstart", function(e) {
      e.preventDefault();
      jumpOrRestart();
    });
    gameCanvas.addEventListener("mousedown", jumpOrRestart);
  </script>
</body>
</html>
